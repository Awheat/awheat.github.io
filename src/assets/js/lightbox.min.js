!function(i,t){var o=function(i){i=i||{},this.elem=i.elem,this.init(),this.renderDOM(),this.bind()};o.prototype={init:function(){this.winWidth=i(t).width(),this.winHeight=i(t).height(),this.domBody=i(document.body)},renderDOM:function(){this.popMask=i('<div id="lightbox-mask"></div>'),this.popWrap=i('<div id="lightbox-wrap"></div>');var t=[];t.push('<div class="lightbox-picture">'),t.push('<img class="lightbox-img" src="" />'),t.push('<span class="lightbox-btn prev-btn"></span>'),t.push('<span class="lightbox-btn next-btn"></span>'),t.push("</div>"),t.push('<div class="lightbox-caption">'),t.push('<h3 class="lightbox-caption-desc"></h3>'),t.push('<p class="lightbox-caption-ind"></p>'),t.push('<span class="lightbox-close-btn"></span>'),t.push("</div>"),this.popWrap.html(t.join("")),this.domBody.append(this.popMask,this.popWrap)},bind:function(){var t=this;this.popPicture=this.popWrap.find("div.lightbox-picture"),this.popCaption=this.popWrap.find("div.lightbox-caption"),this.popImage=this.popWrap.find("img.lightbox-img"),this.popPrevBtn=this.popWrap.find("span.prev-btn"),this.popNextBtn=this.popWrap.find("span.next-btn"),this.popDesc=this.popWrap.find("h3.lightbox-caption-desc"),this.popInd=this.popWrap.find("p.lightbox-caption-ind"),this.popCloseBtn=this.popWrap.find("span.lightbox-close-btn"),this.groupName=null,this.groupData=[],this.domBody.on("click",this.elem,function(o){o.stopPropagation();var p=i(this),n=p.attr("data-group");n!=t.groupName&&(t.groupName=n,t.getDataByGroupName()),t.initLightBox(p)}),this.popCaption.on("click",this.popCloseBtn,function(i){i.stopPropagation(),t.popWrap.fadeOut(),t.popMask.fadeOut()})},getDataByGroupName:function(){this.domBody.find("*[data-group="+this.groupName+"]")},initLightBox:function(i){var t=this,o=i.children("img").attr("src");this.popImage.hide(),this.popCaption.hide();var p=this.popWrap.width(),n=this.popWrap.height();this.popMask.fadeIn(),this.popWrap.fadeIn(),this.popWrap.css({top:-this.winHeight,marginLeft:-(p/2)}).animate({top:(this.winHeight-n)/2},function(){t.loadImages(o)})},loadImages:function(i){var t=this;this.popImage.css({width:"auto",height:"auto"}).hide(),this.imgIsComplete(i,function(){t.popImage.attr("src",i);var o=t.popImage.width(),p=t.popImage.height();console.log("原图:"+o+"---"+p);var n=Math.min(t.winWidth/(o+20),t.winHeight/(p+20),1);o=Math.floor(o*n),p=Math.floor(p*n),t.popWrap.animate({width:o,height:p,marginLeft:-(o/2),top:(t.winHeight-p)/2},function(){t.popImage.css({width:o-20,height:p-20}).fadeIn(),t.popCaption.fadeIn()}),console.log("计算:"+o+"---"+p),console.log("视口:"+t.winWidth+"---"+t.winHeight),console.log("*********************************************")})},imgIsComplete:function(i,o){var p=new Image;t.ActiveXObject?p.onreadystatechange=function(){"complete"==this.readyState&&o()}:p.onload=function(){o()},p.src=i}},t.LightBox=o}(jQuery,window),function(){window.onload=function(){lightbox=new LightBox({elem:".js-lightbox"})}}();